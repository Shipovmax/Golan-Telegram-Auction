{% extends "base.html" %}

{% block title %}Регистрация - Голландский Аукцион Golan{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        <!-- Заголовок -->
        <div class="text-center animate-fade-in">
            <h2 class="mt-6 text-3xl font-extrabold text-white">
                Присоединяйтесь к аукциону!
            </h2>
            <p class="mt-2 text-sm text-gray-300">
                Создайте аккаунт и начните играть
            </p>
        </div>

        <!-- Форма регистрации -->
        <div class="card animate-fade-in delay-200">
            <form method="POST" class="space-y-6">
                {{ form.hidden_tag() }}
                
                <!-- Имя пользователя -->
                <div class="form-group">
                    {{ form.username.label(class="form-label") }}
                    {{ form.username(class="form-input", placeholder="Выберите имя пользователя") }}
                    {% if form.username.errors %}
                        {% for error in form.username.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <!-- Email -->
                <div class="form-group">
                    {{ form.email.label(class="form-label") }}
                    {{ form.email(class="form-input", placeholder="Введите ваш email") }}
                    {% if form.email.errors %}
                        {% for error in form.email.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <!-- Имя и Фамилия -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        {{ form.first_name.label(class="form-label") }}
                        {{ form.first_name(class="form-input", placeholder="Имя") }}
                        {% if form.first_name.errors %}
                            {% for error in form.first_name.errors %}
                                <div class="form-error">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        {{ form.last_name.label(class="form-label") }}
                        {{ form.last_name(class="form-input", placeholder="Фамилия") }}
                        {% if form.last_name.errors %}
                            {% for error in form.last_name.errors %}
                                <div class="form-error">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>

                <!-- Пароль -->
                <div class="form-group">
                    {{ form.password.label(class="form-label") }}
                    {{ form.password(class="form-input", placeholder="Создайте пароль", id="password") }}
                    {% if form.password.errors %}
                        {% for error in form.password.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                    <div class="mt-2">
                        <div class="text-xs text-gray-400">
                            Пароль должен содержать минимум 8 символов, включая заглавные и строчные буквы, цифры и специальные символы
                        </div>
                    </div>
                </div>

                <!-- Подтверждение пароля -->
                <div class="form-group">
                    {{ form.password2.label(class="form-label") }}
                    {{ form.password2(class="form-input", placeholder="Подтвердите пароль", id="password2") }}
                    {% if form.password2.errors %}
                        {% for error in form.password2.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <!-- Согласие с условиями -->
                <div class="flex items-start">
                    {{ form.agree_terms(class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded mt-1") }}
                    <div class="ml-3">
                        {{ form.agree_terms.label(class="text-sm text-gray-300") }}
                        <a href="#" class="text-primary hover:text-primary-light transition-colors">условиями использования</a>
                    </div>
                </div>
                {% if form.agree_terms.errors %}
                    {% for error in form.agree_terms.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}

                <!-- Кнопка регистрации -->
                <div>
                    {{ form.submit(class="btn btn-primary btn-lg w-full") }}
                </div>

                <!-- Ссылка на вход -->
                <div class="text-center">
                    <p class="text-sm text-gray-300">
                        Уже есть аккаунт? 
                        <a href="{{ url_for('auth.login') }}" class="font-medium text-primary hover:text-primary-light transition-colors">
                            Войти
                        </a>
                    </p>
                </div>
            </form>
        </div>

        <!-- Дополнительная информация -->
        <div class="text-center animate-fade-in delay-400">
            <p class="text-xs text-gray-400">
                Регистрируясь, вы получаете доступ к эксклюзивным играм и призам
            </p>
        </div>
    </div>
</div>

<!-- Фоновые элементы -->
<div class="fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-40 -right-32 w-80 h-80 bg-primary rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-float"></div>
    <div class="absolute -bottom-40 -left-32 w-80 h-80 bg-secondary rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-float delay-300"></div>
    <div class="absolute top-40 left-40 w-60 h-60 bg-accent rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-float delay-500"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Анимация появления элементов
    const elements = document.querySelectorAll('.animate-fade-in');
    elements.forEach((element, index) => {
        element.style.animationDelay = `${index * 0.1}s`;
    });

    // Валидация пароля в реальном времени
    const password = document.getElementById('password');
    const password2 = document.getElementById('password2');
    
    function validatePassword() {
        const value = password.value;
        const hasUpper = /[A-Z]/.test(value);
        const hasLower = /[a-z]/.test(value);
        const hasNumber = /\d/.test(value);
        const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(value);
        const hasLength = value.length >= 8;
        
        const isValid = hasUpper && hasLower && hasNumber && hasSpecial && hasLength;
        
        if (value.length > 0) {
            password.classList.toggle('border-green-500', isValid);
            password.classList.toggle('border-red-500', !isValid);
        }
        
        return isValid;
    }
    
    function validatePasswordMatch() {
        const match = password.value === password2.value;
        
        if (password2.value.length > 0) {
            password2.classList.toggle('border-green-500', match);
            password2.classList.toggle('border-red-500', !match);
        }
        
        return match;
    }
    
    password.addEventListener('input', validatePassword);
    password2.addEventListener('input', validatePasswordMatch);

    // Валидация формы
    const form = document.querySelector('form');
    const inputs = form.querySelectorAll('.form-input');
    
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            if (this.value.trim() === '') {
                this.classList.add('border-red-500');
            } else {
                this.classList.remove('border-red-500');
                this.classList.add('border-green-500');
            }
        });
        
        input.addEventListener('focus', function() {
            this.classList.remove('border-red-500', 'border-green-500');
        });
    });

    // Обработка отправки формы
    form.addEventListener('submit', function(e) {
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<div class="loading"></div> Регистрация...';
        submitBtn.disabled = true;
    });

    // Проверка доступности имени пользователя
    const usernameInput = document.querySelector('input[name="username"]');
    let usernameTimeout;
    
    usernameInput.addEventListener('input', function() {
        clearTimeout(usernameTimeout);
        const username = this.value;
        
        if (username.length >= 3) {
            usernameTimeout = setTimeout(() => {
                // Здесь можно добавить AJAX запрос для проверки доступности
                console.log('Checking username availability:', username);
            }, 500);
        }
    });
});
</script>
{% endblock %}
